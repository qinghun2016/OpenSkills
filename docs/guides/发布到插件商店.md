# 发布 OpenSkills 插件到商店并展示 GitHub 地址

本文说明如何把 OpenSkills 扩展发布到 **VS Code / Cursor 扩展商店**（Visual Studio Marketplace），并让用户在商店页看到你的 **GitHub 仓库地址**。

---

## 一、在 package.json 里填写 GitHub 地址

扩展的 `packages/extension/package.json` 已包含以下字段，商店会用来显示「Repository」「Homepage」「Issues」链接：

- **repository**：仓库地址（用户点「Repository」会跳转到这里）
- **homepage**：首页，一般指向 README
- **bugs**：问题反馈地址，一般指向 GitHub Issues

**你需要做的**：把其中的 `YOUR_GITHUB_USER_OR_ORG` 替换成你的 **GitHub 用户名或组织名**。

例如你的仓库是 `https://github.com/zhangsan/OpenSkills`，则：

1. 打开 `packages/extension/package.json`
2. 将三处 `YOUR_GITHUB_USER_OR_ORG` 全部替换为 `zhangsan`：

```json
"repository": {
  "type": "git",
  "url": "https://github.com/zhangsan/OpenSkills.git"
},
"homepage": "https://github.com/zhangsan/OpenSkills#readme",
"bugs": {
  "url": "https://github.com/zhangsan/OpenSkills/issues"
},
```

保存后，发布到商店时用户就能在扩展详情页的 **Resources** 区域看到「Repository」等链接，方便访问你的 GitHub。

---

## 二、发布到 Visual Studio Marketplace 的步骤

VS Code / Cursor 使用同一套商店（Visual Studio Marketplace），用 **vsce** 命令行工具发布。

### 1. 安装 vsce

```bash
npm install -g @vscode/vsce
```

### 2. 创建 Publisher（仅首次需要）

1. 打开 [Visual Studio Marketplace - 管理发布者](https://marketplace.visualstudio.com/manage)
2. 用 **Microsoft 账号**登录
3. 点击 **Create publisher**
4. 填写：
   - **ID**：唯一标识，会出现在扩展 URL 中（如 `openskills.openskills`），**创建后不可改**
   - **Name**：显示名称（如你的昵称或项目名）
5. 点击 **Create** 完成

若 `package.json` 里已有 `"publisher": "openskills"`，则这里创建的 Publisher **ID** 需与之一致（即填 `openskills`），否则发布时要用 `--publisher` 指定。

### 3. 获取 Personal Access Token (PAT)

发布必须使用 **Azure DevOps 的 PAT**：

1. 打开 [Azure DevOps 用户设置 - Personal access tokens](https://go.microsoft.com/fwlink/?LinkId=307137)，选择你的组织
2. 点击 **New Token**
3. 设置：
   - **Name**：随意（如 `vsce-publish`）
   - **Organization**：选 **All accessible organizations**
   - **Scopes**：选 **Custom defined** → 展开 **Marketplace** → 勾选 **Manage**
4. 点击 **Create**，**复制并妥善保存** PAT（只显示一次）

### 4. 登录 vsce

在项目根目录或 `packages/extension` 下执行（将 `<publisher-id>` 换成你的 Publisher ID，如 `openskills`）：

```bash
cd packages/extension
vsce login <publisher-id>
```

按提示粘贴 PAT，验证通过即可。

### 5. 打包并发布

```bash
cd packages/extension
npm run compile
npx vsce package
npx vsce publish
```

- `vsce package`：生成 `.vsix` 文件，可先本地安装测试
- `vsce publish`：上传到 Marketplace，**会要求再次输入 PAT**（若未保存可重新生成一个）

**可选**：自动升级版本再发布：

```bash
npx vsce publish minor   # 0.1.0 → 0.2.0
npx vsce publish patch   # 0.1.0 → 0.1.1
```

### 6. 发布后

- 商店页会显示你在 `package.json` 里配置的 **repository / homepage / bugs**，用户可点击进入你的 GitHub
- 管理扩展、查看安装量/评分：仍到 [Manage Publishers & Extensions](https://marketplace.visualstudio.com/manage)

---

## 三、发布前检查（推荐）

| 项目 | 说明 |
|------|------|
| **icon** | `package.json` 中 `icon` 指向 PNG（至少 128×128）。本扩展使用 `media/icon.png`，符合要求；商店不接受 SVG 作为扩展图标。 |
| **README** | `packages/extension` 根目录有 `README.md` 时，商店会将其作为扩展详情正文展示。 |
| **CHANGELOG** | 若有 `CHANGELOG.md`，商店会展示更新历史。 |
| **版本号** | 使用 [SemVer](https://semver.org/)，如 `0.1.0`。 |

---

## 四、常见问题

- **403 / 401 发布失败**：检查 PAT 的 Organization 是否选了 **All accessible organizations**，Scopes 是否包含 **Marketplace → Manage**。
- **扩展名已存在**：Marketplace 要求扩展的 `name` 与 `displayName` 在商店内唯一，若冲突需改名或换 Publisher。
- **SVG 被拒**：扩展图标不能为 SVG；README/CHANGELOG 中的图片需为 `https`，且不能是未在白名单的 SVG。

更多细节见官方文档：[Publishing Extensions](https://code.visualstudio.com/api/working-with-extensions/publishing-extension)。
