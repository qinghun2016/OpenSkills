# OpenSkills 交接文档

**更新日期**: 2026-01-25  
**状态**: 架构修复与初始化改进已完成；Cursor Agent CLI 需用户本机单独安装

---

## 一、近期变更摘要

### 1. 架构修复：「唤醒」= 真正启动 Cursor Agent

- **问题**：原设计里 Wake 只写 `wake/pending.json`，扩展「触发唤醒」只调 API，**从未真正调用 Cursor/VSCode Agent**。
- **修复**：扩展「触发唤醒」在启用 `openskills.wakeUseAgentCli` 且已安装 **Cursor Agent CLI** 时，在项目目录执行 `agent chat "审查建议，担任 skills-admin..."`，**真正启动 Cursor Agent** 跑 skills-admin。
- **详见**：`docs/ARCHITECTURE_FIX.md`  
- **相关**：`QUICK_REFERENCE.md` 中「Skills-admin 与唤醒 Agent」、`packages/extension/src/commands/triggerWake.ts`

### 2. 初始化逻辑：检查已有 Skills，仅缺 skills-admin 时生成

- **行为**：初始化时统计项目级、用户级 Skills 数量；**仅当不存在 skills-admin**（项目或用户）时，才在项目中生成 `.cursor/skills/skills-admin/SKILL.md`；已有则跳过。
- **相关**：`packages/extension/src/commands/init.ts`

### 3. 初始化体验：输出日志、模态确认、明确反馈

- **行为**：执行 **OpenSkills: Initialize** 时自动打开 **输出 → OpenSkills**，逐步打日志；若已初始化则弹出**模态**「是否重新初始化？」；取消时提示「已取消初始化」，完成时提示「详见 输出 → OpenSkills」。
- **相关**：同上 `init.ts`

### 4. 扩展配置

- `openskills.wakeUseAgentCli`：是否用 Cursor Agent CLI 唤醒（默认 `true`）。
- `openskills.wakeAgentPrompt`：自定义唤醒 prompt，为空则用默认。

---

## 二、Cursor Agent CLI

### 是否需单独安装

**需要。** 装 Cursor 编辑器 ≠ 有 `agent` 命令，CLI 需单独安装。

### 安装方式（官方）

- **macOS / Linux / Windows (WSL)**：
  ```bash
  curl https://cursor.com/install -fsSL | bash
  ```
- 安装后把 `~/.local/bin` 加入 PATH，执行 `agent --version` 验证。

### Windows 本机（无 WSL）

- 官方推荐用 **WSL** 安装。若用 Git Bash，可在 Git Bash 中执行上述命令；纯 PowerShell 需参考 [Cursor CLI 安装说明](https://cursor.com/docs/cli/installation)。

### 与 OpenSkills 的关系

- **触发唤醒** 会执行 `agent chat "..."`；未检测到 CLI 时提示安装或改用手动在聊天输入「审查建议」。

---

## 三、Todo List（交接与验证）

### 3.1 接手必做

- [ ] **拉代码、装依赖**
  - `git pull` → `npm install`（项目根）
  - 验证：`npm run build` 或各 package 的 `npm run compile` 无报错

- [ ] **启动开发环境**
  - `docker-compose -f docker-compose.dev.yml up -d`
  - 验证：实际 API 地址 /health 返回 OK，实际 Web 地址（默认 3848）可打开 Web

- [ ] **扩展调试**
  - 打开本项目文件夹 → F5 → 选择「运行扩展」
  - 验证：侧边栏见 **OpenSkills** 图标，左下角状态栏有 `OpenSkills` 或 `X pending`

- [ ] **初始化流程**
  - 命令面板 → **OpenSkills: Initialize** → 若已初始化则弹窗选「是」重新初始化
  - 验证：**输出 → OpenSkills** 出现 `[Init] 初始化完成`，无报错

### 3.2 唤醒 Agent（依赖 Cursor Agent CLI）

- [ ] **安装 Cursor Agent CLI**（若要使用「触发唤醒」启动 Agent）
  - WSL 或 Git Bash：`curl https://cursor.com/install -fsSL | bash`
  - 将 `~/.local/bin` 加入 PATH，执行 `agent --version` 验证

- [ ] **验证触发唤醒**
  - 在 OpenSkills 项目中执行 **OpenSkills: Trigger Wake**
  - 验证：弹出「OpenSkills Wake」终端并执行 `agent chat "..."`；若未装 CLI 则提示安装或手动聊天

### 3.3 自检清单（可逐项勾选）

- [ ] Docker 服务正常（`docker ps` 见 api、web 等）
- [ ] API 健康检查通过：`http://localhost:3000/health`
- [ ] Web 可访问：实际 Web 地址（默认 3848，由配置/环境变量决定）
- [ ] Config 页保存正常（Web 端配置页）
- [ ] 扩展侧边栏 Skills / Proposals 有数据或空状态正确
- [ ] **OpenSkills: Initialize** 输出完整、无报错
- [ ] （若已装 CLI）**OpenSkills: Trigger Wake** 能启动 Agent 终端

### 3.4 可选改进

- [ ] 将 Cursor CLI 安装步骤写入 `QUICK_REFERENCE.md` 或 `README`
- [ ] 为「触发唤醒」增加单元测试或集成测试
- [ ] 补充 `ARCHITECTURE_FIX.md` 中 Windows 非 WSL 的安装说明（若官方更新）

### 3.5 无需操作

- **API 重启**：本次架构修复、初始化、唤醒改动均未改 API；**无需**因扩展/初始化变更重启 API 或 Docker。

---

## 四、关键文件速查

| 文件 | 用途 |
|------|------|
| `docs/guides/QUICK_REFERENCE.md` | 快速启动、修复命令、Skills-admin 与唤醒说明 |
| `docs/ARCHITECTURE_FIX.md` | 架构问题与修复方案 |
| `docs/handover/交接文档-20260124-工作交接.md` | 历史 BUG 修复与配置 |
| `.openskills/config.json` | 项目配置（含 adminMode、wake、handoff） |
| `packages/extension/src/commands/triggerWake.ts` | 触发唤醒（含 Agent CLI 调用） |
| `packages/extension/src/commands/init.ts` | 初始化（检查 Skills、生成 skills-admin） |

---

## 五、快速自检

- **初始化**：打开项目文件夹 → **OpenSkills: Initialize** → 输出出现 `[Init] 初始化完成`。
- **唤醒**：若已装 CLI → **OpenSkills: Trigger Wake** 应启动「OpenSkills Wake」终端；未装则提示安装或手动聊天。
- **API**：`http://localhost:3000/health` 可访问即正常；扩展改动**无需**重启 API。

详细步骤与勾选项见 **三、Todo List**。
